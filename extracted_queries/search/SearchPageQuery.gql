# Query Name: SearchPageQuery
# Entity Type: search
# Description:
# Multi-entity search query that returns paginated search results across
#  targets, diseases, drugs, variants, and studies. Also fetches the top hit
#  for each entity type to display as a detail panel.
# Variables: queryString: String!, index: Int!, entityNames: [String!]!
# Pagination Behavior: Paginated (returns 10/page fixed)
# Notes:
# Query executes successfully. Tested with queryString='BRAF', returned 1,239
#  total results with aggregations showing disease (1,205), study (111), drug
#  (27), and target (7) hits. Top hit correctly returns most relevant BRAF
#  target.
#
# Last Updated: 2025-11-21
query SearchPageQuery($queryString: String!, $index: Int!, $entityNames: [String!]!) {
  # Multi entity search
  search(queryString: $queryString, entityNames: $entityNames, page: { index: $index, size: 10 }) {
    # Total number or results given a entity filter
    total
    # Aggregations
    aggregations {
      entities {
        name
        total
      }
    }
    # Return combined
    hits {
      id
      highlights
      # Associations for a fixed target
      object {
        ... on Variant {
          id
          variantDescription
          referenceAllele
          alternateAllele
          rsIds
        }

        ... on Study {
          # The study identifier
          id
          hasSumstats
          traitFromSource
          nSamples
          publicationDate
          publicationFirstAuthor
          publicationJournal
          # The study type
          studyType
          # biosample
          biosample {
            biosampleName
          }
          # Target
          target {
            # HGNC approved symbol
            approvedSymbol
          }
          # Credible sets
          credibleSets {
            credibleSetsCount: count
          }
        }

        ... on Target {
          # Open Targets target id
          id
          # HGNC approved symbol
          approvedSymbol
          # ...
          functionDescriptions
        }

        ... on Disease {
          # Open Targets disease id
          id
          # Disease name
          name
          # Disease description
          description
        }

        ... on Drug {
          # Open Targets molecule id
          id
          # Molecule preferred name
          name
          # Drug description
          description
        }
      }
    }
  }
  # Multi entity search
  topHit: search(
    queryString: $queryString
    entityNames: $entityNames
    page: { index: 0, size: 1 }
  ) {
    # Return combined
    hits {
      # Associations for a fixed target
      object {
        ... on Variant {
          id
          variantDescription
          chromosome
          position
          referenceAllele
          alternateAllele
          rsIds
          # Most severe consequence sequence ontology
          mostSevereConsequence {
            label
          }
        }
        ... on Study {
          # The study identifier
          id
          hasSumstats
          traitFromSource
          # Credible sets
          credibleSets {
            count
          }
        }
        ... on Target {
          # Open Targets target id
          id
          # HGNC approved symbol
          approvedSymbol
          # Approved gene name
          approvedName
          # ...
          functionDescriptions
          # Molecule biotype
          biotype
          # Related protein IDs
          proteinIds {
            id
            source
          }
        }
        ... on Disease {
          # Open Targets disease id
          id
          # Disease name
          name
          # Disease description
          description
          # Ancestor therapeutic area disease entities in ontology
          therapeuticAreas {
            # Open Targets disease id
            id
            # Disease name
            name
          }
        }
        ... on Drug {
          # Open Targets molecule id
          id
          # Drug description
          description
          # Molecule preferred name
          name
          # Drug modality
          drugType
          # Maximum phase observed in clinical trial records and post-marketing package inserts
          maximumClinicalTrialPhase
          # Has drug been withdrawn from the market
          hasBeenWithdrawn
          # Investigational and approved indications curated from clinical trial records and post-marketing package inserts
          indications {
            rows {
              # Disease
              disease {
                # Open Targets disease id
                id
                # Disease name
                name
              }
            }
          }
          # Molecule targets based on drug mechanism of action
          linkedTargets {
            count
            # Target List
            rows {
              # Open Targets target id
              id
              # HGNC approved symbol
              approvedSymbol
            }
          }
          # Molecule synonyms
          synonyms
          # Drug trade names
          tradeNames
        }
      }
    }
  }
}
