# Query Name: ChemblQuery
# Entity Type: evidence
# Description:
# Fetches ChEMBL clinical trial evidence for a target-disease association,
#  including drug information, mechanisms of action, clinical phases, trial
#  status, and direction of effect with cursor-based pagination
# Variables:
# ensemblId: String! (Example: ENSG00000157764), efoId: String! (Example:
#  EFO_0000756), size: Int! (Example: 10), cursor: String (optional)
# Pagination Behavior: Paginated (cursor-based, returns cursor field for next page)
# Notes:
# Query executes successfully. Tested with BRAF (ENSG00000157764) + melanoma
#  (EFO_0000756), returned count=226 total evidence entries. First page
#  (size=10) returned 10 rows with cursor for next page. Includes
#  comprehensive drug data: VEMURAFENIB, DABRAFENIB, ENCORAFENIB all Phase 4,
#  variantEffect (LoF), directionOnTrait (protect), mechanismsOfAction (B-raf
#  inhibitor), targetFromSourceId (P15056), clinicalStatus
#  (Completed/Terminated), studyStartDate, studyStopReason/Categories,
#  cohortPhenotypes, and urls (DailyMed, EMA, FDA, ClinicalTrials).
#  Cursor-based pagination confirmed working with second page test. Related to
#  ChemblSummaryFragment.gql which fetches only count for summary display.
#
# Last Updated: 2025-11-21
query ChemblQuery($ensemblId: String!, $efoId: String!, $size: Int!, $cursor: String) {
  # Return a Disease
  disease(efoId: $efoId) {
    # Open Targets disease id
    id
    # The complete list of all possible datasources
    chembl: evidences(
      ensemblIds: [$ensemblId]
      enableIndirect: true
      datasourceIds: ["chembl"]
      size: $size
      cursor: $cursor
    ) {
      cursor
      count
      rows {
        # Disease evidence
        disease {
          # Open Targets disease id
          id
          # Disease name
          name
        }
        # Target evidence
        target {
          # Open Targets target id
          id
          # HGNC approved symbol
          approvedSymbol
        }
        drug {
          # Open Targets molecule id
          id
          # Molecule preferred name
          name
          # Drug modality
          drugType
          # Mechanisms of action to produce intended pharmacological effects. Curated from scientific literature and post-marketing package inserts
          mechanismsOfAction {
            rows {
              mechanismOfAction
              # Target List
              targets {
                # Open Targets target id
                id
                # HGNC approved symbol
                approvedSymbol
              }
            }
          }
        }
        # Variant effect
        variantEffect
        # Direction On Trait
        directionOnTrait
        targetFromSourceId
        clinicalPhase
        clinicalStatus
        studyStartDate
        studyStopReason
        # Predicted reason(s) why the study has been stopped based on studyStopReason
        studyStopReasonCategories
        cohortPhenotypes
        urls {
          niceName
          url
        }
      }
    }
  }
}
