# Query Name: VariantGWASCredibleSetsQuery
# Entity Type: variant
# Description:
# Retrieves GWAS credible sets associated with a variant including lead
#  variants study information fine-mapping confidence posterior probabilities
#  and top L2G gene predictions for each credible set.
# Variables: variantId: String!, size: Int!, index: Int!
# Pagination Behavior: Paginated (batch: 500/page default)
# Notes:
# Query successfully tested with 19_44908822_C_T (APOE rs7412), returned
#  count=1102 GWAS credible sets.
#
# Last Updated: 2025-11-21
query VariantGWASCredibleSetsQuery($variantId: String!, $size: Int!, $index: Int!) {
  # Return a Variant
  variant(variantId: $variantId) {
    id
    referenceAllele
    alternateAllele
    # Credible sets
    gwasCredibleSets: credibleSets(studyTypes: [gwas], page: { size: $size, index: $index }) {
      count
      rows {
        studyLocusId
        pValueMantissa
        pValueExponent
        beta
        finemappingMethod
        confidence
        variant {
          id
          chromosome
          position
          referenceAllele
          alternateAllele
        }
        # Gwas study
        study {
          traitFromSource
          # The study identifier
          id
          diseases {
            # Disease name
            name
            # Open Targets disease id
            id
            # Ancestor therapeutic area disease entities in ontology
            therapeuticAreas {
              # Disease name
              name
              # Open Targets disease id
              id
            }
          }
        }
        locus(variantIds: [$variantId]) {
          rows {
            posteriorProbability
          }
        }
        locusSize: locus {
          count
        }
        l2GPredictions(page: { size: 1, index: 0 }) {
          rows {
            # Target
            target {
              # Open Targets target id
              id
              # HGNC approved symbol
              approvedSymbol
            }
            score
          }
        }
      }
    }
  }
}
