# Query Name: VariantQTLCredibleSetsQuery
# Entity Type: variant
# Description:
# Retrieves QTL (Quantitative Trait Loci) credible sets associated with a
#  genetic variant including study details lead variants fine-mapping
#  statistics and posterior probabilities. Uses batch pagination.
# Variables: variantId: String!, size: Int!, index: Int!
# Pagination Behavior: Paginated (batch: 500/page default)
# Notes:
# Query successfully tested with 19_44908822_C_T (APOE rs7412), returned
#  count=27 QTL credible sets.
#
# Last Updated: 2025-11-21
query VariantQTLCredibleSetsQuery($variantId: String!, $size: Int!, $index: Int!) {
  # Return a Variant
  variant(variantId: $variantId) {
    id
    referenceAllele
    alternateAllele
    # Credible sets
    qtlCredibleSets: credibleSets(
      studyTypes: [scsqtl, sceqtl, scpqtl, sctuqtl, sqtl, eqtl, pqtl, tuqtl]
      page: { size: $size, index: $index }
    ) {
      count
      rows {
        studyLocusId
        pValueMantissa
        pValueExponent
        beta
        finemappingMethod
        confidence
        isTransQtl
        variant {
          id
          chromosome
          position
          referenceAllele
          alternateAllele
        }
        # Gwas study
        study {
          # The study identifier
          id
          # The study type
          studyType
          # Condition
          condition
          # Target
          target {
            # Open Targets target id
            id
            # HGNC approved symbol
            approvedSymbol
          }
          # biosample
          biosample {
            biosampleId
            biosampleName
          }
        }
        locus(variantIds: [$variantId]) {
          rows {
            posteriorProbability
          }
        }
        locusSize: locus {
          count
        }
      }
    }
  }
}
